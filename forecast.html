<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Scrummer ‚Äî Role Based Forecast</title>
<link rel="stylesheet" href="css/style.css"/>
</head>

<body>
<div class="appShell">

  <!-- SIDEBAR -->
  <aside class="sideNav">
    <div class="sideBrand">
      <div class="brandMark">üêÜ</div>
      <div>
        <div class="brandName">SCRUMMER</div>
        <div class="brandTag">Gamified Scrum OS</div>
      </div>
    </div>

    <nav class="nav">
      <a class="navlink" href="index.html">üöÄ Setup</a>
      <a class="navlink active" href="forecast.html">üì¶ Forecast</a>
    </nav>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <div class="sectionCard">

      <h1 class="sectionTitle">Role-Based Capacity Forecast</h1>
      <p class="sectionSub">
        Focus Factor √ó Role Capacity √ó Weighted Leaves
      </p>

      <!-- Sprint Inputs -->
      <div class="info-banner">
        <div style="font-weight:900; margin-bottom:12px;">Sprint Setup</div>

        <div style="display:grid; gap:10px;">
          <input class="fun-input" id="sprintDays" type="number" placeholder="Total Sprint Days (e.g. 10)">
          <input class="fun-input" id="focusFactor" type="number" step="0.01" placeholder="Focus Factor (e.g. 0.6)">
          <input class="fun-input" id="spPerDay" type="number" step="0.1" value="4" placeholder="SP per Day">
          <input class="fun-input" id="unavailabilityWeight" type="number" step="0.1" value="0.5" placeholder="Unavailability Weight (0-1)">
        </div>
      </div>

      <!-- Roles Section -->
      <div class="sectionCard" style="margin-top:18px;">
        <div style="font-weight:900; margin-bottom:10px;">Team Roles</div>

        <div id="rolesContainer"></div>

        <button class="btnPrimary" id="addRoleBtn" style="margin-top:12px;">
          + Add Role
        </button>
      </div>

      <!-- Results -->
      <div class="info-banner" style="margin-top:18px;">
        <div id="idealPerMemberResult"></div>
        <div id="totalActualDays"></div>
        <div id="totalActualSP"></div>
      </div>

    </div>
  </main>

</div>

<script>
(() => {

  const $ = (id) => document.getElementById(id);

  function num(val, fallback = 0) {
    const n = Number(val);
    return Number.isFinite(n) ? n : fallback;
  }

  function round(n) {
    return Math.round(n * 100) / 100;
  }

  let roleIndex = 0;

  function addRoleRow(name = "", members = "", leaves = "") {

    const container = $("rolesContainer");

    const row = document.createElement("div");
    row.className = "roleRow";
    row.style.marginBottom = "14px";
    row.style.padding = "12px";
    row.style.border = "1px solid var(--border)";
    row.style.borderRadius = "16px";

    row.innerHTML = `
      <div style="display:grid; gap:8px;">
        <input class="fun-input roleName" placeholder="Role Name (e.g. Dev, QA)" value="${name}">
        <input class="fun-input roleMembers" type="number" min="0" placeholder="Members" value="${members}">
        <input class="fun-input roleLeaves" type="number" min="0" placeholder="Leaves (person-days)" value="${leaves}">
        <button class="btnGhost removeRole">Remove Role</button>
        <div class="roleResult" style="margin-top:8px; font-weight:800;"></div>
      </div>
    `;

    container.appendChild(row);

    row.querySelector(".removeRole").addEventListener("click", () => {
      row.remove();
      calculate();
    });

    row.querySelectorAll("input").forEach(input =>
      input.addEventListener("input", calculate)
    );
  }

  function calculate() {

    const sprintDays = num($("sprintDays").value);
    const focusFactor = num($("focusFactor").value);
    const spPerDay = num($("spPerDay").value);
    const weight = num($("unavailabilityWeight").value);

    const idealPerMember = sprintDays * focusFactor;

    let totalActualDays = 0;
    let totalActualSP = 0;

    const rows = document.querySelectorAll(".roleRow");

    rows.forEach(row => {

      const roleName = row.querySelector(".roleName").value || "Role";
      const members = num(row.querySelector(".roleMembers").value);
      const leaves = num(row.querySelector(".roleLeaves").value);

      const totalIdealDays = members * idealPerMember;
      const actualDays = totalIdealDays - (leaves * weight);
      const actualSP = actualDays * spPerDay;

      totalActualDays += actualDays;
      totalActualSP += actualSP;

      row.querySelector(".roleResult").innerHTML = `
        <div><b>${roleName}</b></div>
        Ideal Days: ${round(totalIdealDays)}<br>
        Actual Days: ${round(actualDays)}<br>
        Actual SP: ${round(actualSP)}
      `;
    });

    $("idealPerMemberResult").textContent =
      "Ideal Capacity per Member: " + round(idealPerMember) + " days";

    $("totalActualDays").textContent =
      "Total Actual Capacity (Days): " + round(totalActualDays);

    $("totalActualSP").textContent =
      "Total Actual Capacity (Story Points): " + round(totalActualSP);
  }

  function wire() {

    $("addRoleBtn").addEventListener("click", () => addRoleRow());

    ["sprintDays", "focusFactor", "spPerDay", "unavailabilityWeight"]
      .forEach(id => {
        $(id).addEventListener("input", calculate);
      });

    calculate();
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", wire);
  } else {
    wire();
  }

})();
</script>

</body>
</html>